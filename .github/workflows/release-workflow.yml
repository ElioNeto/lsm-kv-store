- name: Extract version and release type
  id: extract
  run: |
    # Extrai versão do nome da branch
    BRANCH_NAME="${{ github.event.pull_request.head.ref }}"
    VERSION=$(echo "$BRANCH_NAME" | sed 's/release\/v//')
    echo "version=$VERSION" >> $GITHUB_OUTPUT

    # Extrai tipo de release do corpo do PR
    # Remove caracteres CRLF e extrai texto dentro dos colchetes
    PR_BODY=$(echo '${{ github.event.pull_request.body }}' | tr -d '\r')

    # Extrai o valor dentro de [alpha], [beta] ou [lts]
    # Regex busca: Release Type: seguido de [palavra]
    RELEASE_TYPE=$(echo "$PR_BODY" | grep -oP 'Release Type:\s*\[\K(alpha|beta|lts)(?=\])' || echo "")

    # Se não encontrou, tenta sem colchetes (fallback)
    if [ -z "$RELEASE_TYPE" ]; then
      RELEASE_TYPE=$(echo "$PR_BODY" | grep -oP 'Release Type:\s*\K(alpha|beta|lts)' || echo "lts")
    fi

    echo "release_type=$RELEASE_TYPE" >> $GITHUB_OUTPUT

    # Monta tag completa
    if [ "$RELEASE_TYPE" = "lts" ]; then
      FULL_TAG="v${VERSION}"
    else
      FULL_TAG="v${VERSION}-${RELEASE_TYPE}"
    fi
    echo "full_tag=$FULL_TAG" >> $GITHUB_OUTPUT

    echo "Version: $VERSION"
    echo "Release Type: $RELEASE_TYPE"
    echo "Full Tag: $FULL_TAG"
